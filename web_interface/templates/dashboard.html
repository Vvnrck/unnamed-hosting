{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block page_title %}Dashboard{% endblock %}

{% block body %}
    <div class="row">
    {% for app in apps %}
        <div class="col-lg-6 app-col">
            <div class="card app" data-app-id="{{ app.pk }}" data-app-name="{{ app.name }}" data-app-desired-state="{{ app.desired_state }}">
                <div class="card-block">
                    <h3 class="card-title">{{ app.name }}</h3>
                    <h6 class="card-subtitle mb-2 text-muted">{{ app.app_type }} app</h6>

                    <p class="card-text">Repo: <a href="{{ app.repo_url }}">{{ app.shorter_repo_url }}</a> <br/>
                    {% if app.current_state == app.desired_state %}
                    Current Status: <span class="app-status">{{ app.current_state|default_if_none:"None" }}</span></p>
                    {% else %}
                    Current Status:  <span class="app-status">{{ app.current_state|default_if_none:"None" }}</span><br/>
                    Transition to: {{ app.desired_state|default_if_none:"None" }}</p>
                    {% endif %}

                    <a href="//{{ app.app_url|default_if_none:"javascript:void(0)" }}" target="_blank" class="btn btn-outline-primary">Open app</a>
                    <a href="{% url 'get-app-logs' %}?app_id={{ app.id }}" class="btn btn-outline-primary">Logs</a>
                    <button class="btn btn-outline-warning stop-app" data-url="{% url 'stop-app' %}">Stop</button>
                    <button class="btn btn-outline-success resume-app" data-url="{% url 'resume-app' %}">Resume</button>
                    <button class="delete-app btn btn-outline-danger">Delete</button>
                </div>
          </div>
      </div>
    {% endfor %}
        <div class="col-lg-6 app-col">
            <div class="card">
                <div class="card-block">
                    <h3 class="new-app-title card-title">Create new app</h3>
                    <button class="new-app-btn btn btn-md btn-outline-success">+</button>
                    <form action="{% url 'new-app' %}" id="new-app-form" method="post" style="display: none">
                        {% csrf_token %}
                        {{ new_app_form|crispy }}
                        <input type="submit" value="Create App" class="btn btn-outline-primary" />
                        <a href="" class="btn btn-link" target="_blank">Be sure to provide hooks!</a>
                    </form>
                </div>
            </div>
        </div>

    </div>


    <div class="modal fade" id="delete-app-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Please confirm</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Please confirm you want to delete <span id="delete-app-modal-app-name"></span>?
                       All database data will be lost.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button"
                            class="confirm-delete-app btn btn-danger"
                            data-action-url="{% url 'delete-app' %}">
                        Delete app
                    </button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>


{% endblock %}
